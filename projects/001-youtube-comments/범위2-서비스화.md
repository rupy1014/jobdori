# 범위2: 서비스화 (SaaS)

> **영상 콘텐츠**: "1인 도구를 SaaS로 만들기 - 유튜브 댓글봇 서비스화"

## 목표

범위1에서 만든 "나만의 대시보드"를
**누구나 가입해서 쓸 수 있는 서비스**로 확장.

---

## 범위1 → 범위2 확장 포인트

| 범위1 (1인용) | 범위2 (서비스) |
|---------------|----------------|
| 내 채널 하나 | 다중 사용자, 다중 채널 |
| 환경변수에 API 키 | 사용자별 YouTube OAuth |
| Basic Auth | 회원가입/로그인 |
| KV (단순 저장) | D1 (관계형 DB) |
| 고정된 설정 | 사용자별 커스터마이징 |
| 무료 | 요금제 (Free/Pro/Business) |
| 버튼 2개 | 자동/수동/검토 모드 |
| 5개 애티튜드 | 커스텀 애티튜드 |

---

## 추가되는 핵심 기능

### 1. 회원 시스템

```
┌─────────────────────────────────────────────────────────────┐
│                      회원 시스템                             │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  • 이메일 회원가입 + 이메일 인증                            │
│  • Google OAuth 로그인                                      │
│  • 비밀번호 찾기                                            │
│  • 프로필 관리                                              │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 2. YouTube 채널 연동

```
┌─────────────────────────────────────────────────────────────┐
│                    채널 연동 플로우                          │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  [채널 연동하기] 버튼                                        │
│        │                                                    │
│        ▼                                                    │
│  YouTube OAuth 동의 화면                                    │
│  "댓글 읽기/쓰기 권한 허용"                                 │
│        │                                                    │
│        ▼                                                    │
│  채널 목록에서 선택                                          │
│        │                                                    │
│        ▼                                                    │
│  refresh_token 암호화 저장                                  │
│                                                             │
│  * 플랜별 채널 수 제한                                      │
│    - Free: 1개                                              │
│    - Pro: 3개                                               │
│    - Business: 10개                                         │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 3. 응답 모드 선택

```
┌─────────────────────────────────────────────────────────────┐
│  🔄 응답 모드                                                │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  (●) 완전 자동                                              │
│      → 댓글 감지 즉시 AI가 응답 게시                        │
│      → Pro 이상                                             │
│                                                             │
│  ( ) 추천 후 검토                                           │
│      → AI가 추천 응답 생성 → 관리자 승인 → 게시            │
│      → 애티튜드 변경 가능                                   │
│                                                             │
│  ( ) 수동만                                                  │
│      → 버튼 클릭 시에만 응답                                │
│      → Free 기본                                            │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 4. 검토 대시보드

```
┌─────────────────────────────────────────────────────────────┐
│  📋 댓글 검토                               [검토 대기: 12] │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ 📹 AI 수익화 3편                                     │   │
│  │ 👤 김철수 · 2시간 전                                 │   │
│  │ "이게 뭔 쓸데없는 영상이야"                          │   │
│  │                                                     │   │
│  │ 🏷️ 부정적  →  추천: 악플대처                        │   │
│  │                                                     │   │
│  │ 💬 AI 추천:                                         │   │
│  │ "피드백 감사합니다! 더 나아지겠습니다 🙏"           │   │
│  │                                                     │   │
│  │ 애티튜드: [악플대처✓] [공감] [소신] [유머] [재생성] │   │
│  │                                                     │   │
│  │              [무시] [수정] [게시]                   │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 5. 커스텀 애티튜드 (Pro)

```
┌─────────────────────────────────────────────────────────────┐
│  ✨ 커스텀 애티튜드                            [+ 새로 만들기]│
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  기본 제공 (8개):                                           │
│  [공감] [감사] [소신발언] [악플대처]                        │
│  [유머] [전문가] [친근] [격려]                              │
│                                                             │
│  내가 만든 애티튜드:                                         │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ 🎭 "개발자st"                                        │   │
│  │ 기술 용어 + 개발자 유머                              │   │
│  │ 예: "버그 아니고 피처입니다 ㅋㅋ"                    │   │
│  │                                          [편집]     │   │
│  └─────────────────────────────────────────────────────┘   │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ 🎭 "MZ감성"                                          │   │
│  │ 밈, 신조어, 줄임말 활용                              │   │
│  │ 예: "ㄹㅇ 인정 ㅋㅋ 갓생 사세요"                     │   │
│  │                                          [편집]     │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 6. 요금제 & 사용량

```
┌─────────────────────────────────────────────────────────────┐
│  💳 요금제                                                   │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐        │
│  │   Free      │  │    Pro      │  │  Business   │        │
│  │   무료      │  │  $9/월      │  │  $29/월     │        │
│  ├─────────────┤  ├─────────────┤  ├─────────────┤        │
│  │ 채널 1개   │  │ 채널 3개   │  │ 채널 10개  │        │
│  │ 월 100응답 │  │ 월 1000응답│  │ 무제한     │        │
│  │ 수동만     │  │ 자동+검토  │  │ 자동+검토  │        │
│  │ 기본 설정  │  │ 커스텀가능 │  │ 전체기능   │        │
│  │            │  │ 본인API키  │  │ 우선지원   │        │
│  └─────────────┘  └─────────────┘  └─────────────┘        │
│                                                             │
│  현재 플랜: Free                                            │
│  이번 달 사용량: 45 / 100 응답                              │
│                                                             │
│                              [Pro로 업그레이드]             │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## 시스템 아키텍처

```
┌─────────────────────────────────────────────────────────────────┐
│                      Cloudflare Workers                         │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐          │
│  │  Auth    │ │ Dashboard│ │   API    │ │  Cron    │          │
│  │ 가입/로그인│ │  웹 UI   │ │  REST   │ │ 자동응답 │          │
│  └──────────┘ └──────────┘ └──────────┘ └──────────┘          │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
          │              │              │              │
          ▼              ▼              ▼              ▼
   ┌───────────┐  ┌───────────┐  ┌───────────┐  ┌───────────┐
   │ D1        │  │ YouTube   │  │ Claude    │  │ KV        │
   │ Database  │  │ OAuth     │  │ API       │  │ Session   │
   │           │  │           │  │           │  │ Cache     │
   │ - Users   │  │ 채널연동  │  │ 분류      │  │           │
   │ - Channels│  │ 댓글조회  │  │ 응답생성  │  │           │
   │ - Settings│  │ 댓글게시  │  │           │  │           │
   │ - Comments│  │           │  │           │  │           │
   │ - Plans   │  │           │  │           │  │           │
   └───────────┘  └───────────┘  └───────────┘  └───────────┘
```

---

## 데이터베이스 스키마 (D1)

### Users

```sql
CREATE TABLE users (
  id TEXT PRIMARY KEY,
  email TEXT UNIQUE NOT NULL,
  password_hash TEXT,
  name TEXT,
  avatar_url TEXT,
  auth_provider TEXT DEFAULT 'email',
  email_verified INTEGER DEFAULT 0,

  -- 플랜
  plan TEXT DEFAULT 'free',
  plan_expires_at TEXT,
  monthly_reply_count INTEGER DEFAULT 0,
  monthly_reset_at TEXT,

  -- 선택: 본인 API 키
  own_claude_api_key TEXT,

  created_at TEXT DEFAULT CURRENT_TIMESTAMP,
  updated_at TEXT DEFAULT CURRENT_TIMESTAMP
);
```

### Channels

```sql
CREATE TABLE channels (
  id TEXT PRIMARY KEY,
  user_id TEXT NOT NULL REFERENCES users(id),

  youtube_channel_id TEXT NOT NULL,
  youtube_channel_title TEXT,
  youtube_channel_thumbnail TEXT,

  -- OAuth (암호화)
  youtube_refresh_token TEXT,
  youtube_token_expires_at TEXT,

  is_active INTEGER DEFAULT 1,
  last_synced_at TEXT,

  created_at TEXT DEFAULT CURRENT_TIMESTAMP,

  UNIQUE(user_id, youtube_channel_id)
);
```

### Channel Settings

```sql
CREATE TABLE channel_settings (
  id TEXT PRIMARY KEY,
  channel_id TEXT NOT NULL REFERENCES channels(id),

  -- 응답 모드
  reply_mode TEXT DEFAULT 'manual',  -- 'auto' | 'review' | 'manual'

  -- 톤앤매너
  persona_name TEXT,
  persona_description TEXT,
  tone TEXT DEFAULT 'friendly',
  max_response_length INTEGER DEFAULT 200,
  custom_instructions TEXT,

  -- 기본 애티튜드
  default_attitude TEXT DEFAULT 'friendly',

  created_at TEXT DEFAULT CURRENT_TIMESTAMP,
  updated_at TEXT DEFAULT CURRENT_TIMESTAMP
);
```

### Attitude Mappings

```sql
CREATE TABLE attitude_mappings (
  id TEXT PRIMARY KEY,
  channel_id TEXT NOT NULL REFERENCES channels(id),

  comment_type TEXT NOT NULL,
  attitude TEXT NOT NULL,

  UNIQUE(channel_id, comment_type)
);
```

### Custom Attitudes

```sql
CREATE TABLE custom_attitudes (
  id TEXT PRIMARY KEY,
  channel_id TEXT NOT NULL REFERENCES channels(id),

  code TEXT NOT NULL,
  name TEXT NOT NULL,
  description TEXT,
  example_responses TEXT,  -- JSON
  prompt_modifier TEXT,

  created_at TEXT DEFAULT CURRENT_TIMESTAMP,

  UNIQUE(channel_id, code)
);
```

### Comments

```sql
CREATE TABLE comments (
  id TEXT PRIMARY KEY,
  channel_id TEXT NOT NULL REFERENCES channels(id),

  youtube_comment_id TEXT NOT NULL,
  youtube_video_id TEXT NOT NULL,
  video_title TEXT,
  author_name TEXT,
  comment_text TEXT NOT NULL,
  published_at TEXT,

  -- 분류
  detected_type TEXT,
  recommended_attitude TEXT,
  selected_attitude TEXT,

  -- AI 추천
  ai_suggested_reply TEXT,

  -- 상태
  status TEXT DEFAULT 'pending',

  -- 응답
  reply_text TEXT,
  youtube_reply_id TEXT,
  replied_at TEXT,
  reply_method TEXT,

  created_at TEXT DEFAULT CURRENT_TIMESTAMP
);
```

---

## API 엔드포인트 (추가분)

### 인증 API

| Method | Path | 설명 |
|--------|------|------|
| `POST` | `/api/auth/signup` | 회원가입 |
| `POST` | `/api/auth/login` | 로그인 |
| `POST` | `/api/auth/logout` | 로그아웃 |
| `GET` | `/api/auth/google` | Google OAuth |
| `POST` | `/api/auth/verify-email` | 이메일 인증 |

### 채널 API

| Method | Path | 설명 |
|--------|------|------|
| `GET` | `/api/channels` | 내 채널 목록 |
| `POST` | `/api/channels/connect` | YouTube 연동 시작 |
| `GET` | `/api/channels/callback` | OAuth 콜백 |
| `DELETE` | `/api/channels/:id` | 연동 해제 |

### 애티튜드 API

| Method | Path | 설명 |
|--------|------|------|
| `GET` | `/api/channels/:id/attitudes` | 애티튜드 목록 |
| `POST` | `/api/channels/:id/attitudes` | 커스텀 생성 |
| `PUT` | `/api/channels/:id/attitudes/:aid` | 수정 |
| `DELETE` | `/api/channels/:id/attitudes/:aid` | 삭제 |
| `PUT` | `/api/channels/:id/attitude-mappings` | 매핑 수정 |

### 댓글 API (확장)

| Method | Path | 설명 |
|--------|------|------|
| `POST` | `/api/channels/:id/comments/:cid/regenerate` | 애티튜드 변경 재생성 |
| `POST` | `/api/channels/:id/comments/:cid/approve` | 검토 승인 |
| `POST` | `/api/channels/:id/comments/:cid/flag` | 검토 대기 표시 |

### 요금제 API

| Method | Path | 설명 |
|--------|------|------|
| `GET` | `/api/plans` | 요금제 목록 |
| `GET` | `/api/usage` | 사용량 조회 |
| `POST` | `/api/subscribe` | 구독 (결제 연동) |

---

## 프로젝트 구조 (확장)

```
001-youtube-comments/
├── wrangler.toml
├── package.json
├── src/
│   ├── index.ts
│   │
│   ├── routes/
│   │   ├── auth.ts           # 인증
│   │   ├── channels.ts       # 채널
│   │   ├── comments.ts       # 댓글
│   │   ├── attitudes.ts      # 애티튜드
│   │   ├── settings.ts       # 설정
│   │   └── billing.ts        # 요금제
│   │
│   ├── handlers/
│   │   ├── scheduled.ts      # Cron
│   │   ├── auth.ts           # 인증 로직
│   │   ├── youtube-oauth.ts  # YouTube 연동
│   │   └── reply.ts          # 응답 생성
│   │
│   ├── services/
│   │   ├── youtube.ts
│   │   ├── claude.ts
│   │   └── classifier.ts
│   │
│   ├── db/
│   │   ├── schema.sql
│   │   └── queries.ts
│   │
│   ├── lib/
│   │   ├── auth.ts           # JWT
│   │   ├── crypto.ts         # 암호화
│   │   └── plan-limits.ts    # 요금제 제한
│   │
│   ├── views/
│   │   ├── landing.ts
│   │   ├── login.ts
│   │   ├── signup.ts
│   │   ├── dashboard.ts
│   │   ├── settings.ts
│   │   ├── review.ts
│   │   └── billing.ts
│   │
│   └── types/
│       └── index.ts
│
└── migrations/
    ├── 0001_users.sql
    ├── 0002_channels.sql
    └── 0003_comments.sql
```

---

## 환경 변수 (추가)

```bash
# 기존 (범위1)
YOUTUBE_CLIENT_ID=xxx
YOUTUBE_CLIENT_SECRET=xxx
CLAUDE_API_KEY=xxx

# 추가 (범위2)
JWT_SECRET=xxx
ENCRYPTION_KEY=xxx

# Google OAuth (로그인용)
GOOGLE_CLIENT_ID=xxx
GOOGLE_CLIENT_SECRET=xxx

# 이메일 발송
RESEND_API_KEY=xxx

# 결제 (선택)
STRIPE_SECRET_KEY=xxx
STRIPE_WEBHOOK_SECRET=xxx
```

---

## 영상 콘텐츠 구성안

### 타이틀
**"1인 도구를 SaaS로 만들기 - 유튜브 댓글봇 서비스화"**

### 목차

1. **인트로** (2분)
   - "저번에 만든 대시보드, 다른 사람도 쓰게 해보자"
   - 완성된 서비스 시연

2. **서비스화란?** (3분)
   - 1인 도구 vs SaaS 차이
   - 멀티테넌트 개념
   - 수익화 포인트

3. **회원 시스템** (8분)
   - D1 데이터베이스 설정
   - 회원가입/로그인 구현
   - JWT 세션 관리

4. **YouTube OAuth** (7분)
   - 사용자별 채널 연동
   - refresh_token 암호화 저장
   - 토큰 갱신 로직

5. **검토 모드 & 애티튜드** (8분)
   - AI 추천 → 승인 플로우
   - 애티튜드 변경 & 재생성
   - 커스텀 애티튜드 CRUD

6. **요금제 설계** (5분)
   - 플랜별 기능 제한
   - 사용량 추적
   - (Stripe 연동은 별도 영상)

7. **배포 & 런칭** (3분)
   - 커스텀 도메인
   - 모니터링 설정
   - 런칭 체크리스트

8. **마무리** (2분)
   - 서비스 확장 아이디어
   - 다음 시리즈 예고

---

## 범위1과의 차이 요약

| 구분 | 범위1 | 범위2 |
|------|-------|-------|
| **대상** | 나 혼자 | 누구나 |
| **저장소** | KV (키-값) | D1 (SQL) |
| **인증** | Basic Auth | JWT + OAuth |
| **채널** | 1개 (환경변수) | 다중 (DB 저장) |
| **응답모드** | 버튼 클릭 | 자동/검토/수동 |
| **애티튜드** | 5개 고정 | 8개 + 커스텀 |
| **요금** | 무료 | Free/Pro/Business |
| **코드량** | ~500줄 | ~2000줄 |
| **개발시간** | 1일 | 1주 |

---

## 예상 개발 시간

| 항목 | 시간 |
|------|------|
| D1 스키마 & 마이그레이션 | 3시간 |
| 회원 시스템 | 6시간 |
| YouTube OAuth 연동 | 4시간 |
| 검토 대시보드 | 6시간 |
| 커스텀 애티튜드 | 4시간 |
| 요금제 & 제한 | 4시간 |
| UI 전체 | 8시간 |
| 테스트 & 디버깅 | 5시간 |
| **총** | **~40시간 (1주)** |
