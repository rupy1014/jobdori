# Spec: 008-posting

## Feature Name
자동 포스팅

## User Value (고객 가치)
- **자동 실행**: 스케줄 설정 후 자동으로 100개 계정 포스팅
- **시간 절약**: 수동 포스팅 100시간 → 자동화로 0시간
- **실시간 확인**: 포스팅 성공/실패 즉시 확인
- **에러 처리**: 실패 시 자동 재시도 및 알림

## Target User (누가 쓸까?)
- **Primary**: 서비스 관리자 (시스템이 자동 실행)
- **Use Case**:
  - 005-approval에서 승인된 콘텐츠 자동 포스팅
  - 스케줄 기반 예약 포스팅
  - 실시간 포스팅 상태 모니터링

## User Journey & Screen Flow

### 1. 포스팅 큐 대시보드
- **UI Elements**:
  - 포스팅 예정 목록 (시간순 정렬)
  - 각 카드: 페르소나명, 이미지 썸네일, 예약 시간, 상태
  - 상태 배지: 🕒대기 / ⚙️진행중 / ✅완료 / ❌실패
  - 필터: 상태, 페르소나, 날짜
- **CTA**: "수동 즉시 포스팅", "스케줄 수정"
- **Next**: 개별 포스팅 상세

### 2. 포스팅 진행 현황 (실시간)
- **UI Elements**:
  - 진행률 바 (성공 N개 / 전체 M개)
  - 실시간 로그 (스크롤 뷰)
    - "[12:00:00] 페르소나 '지수' 포스팅 시작..."
    - "[12:00:15] ✅ 성공! 포스트 ID: 123456"
  - 에러 알림 (빨간색 배지)
- **CTA**: "중단", "새로고침"
- **Next**: 포스팅 완료 → 010-analytics

### 3. 포스팅 상세 (개별)
- **UI Elements**:
  - 이미지 미리보기
  - 캡션 + 해시태그
  - 페르소나 계정 정보
  - 포스팅 결과 (성공 시 인스타그램 URL)
  - 에러 로그 (실패 시)
- **CTA**: "재시도", "인스타그램 확인"
- **Next**: 큐 대시보드

### 4. 실패 처리 화면
- **UI Elements**:
  - 실패한 포스팅 목록
  - 실패 사유 (API 오류, 계정 정지, Rate Limit 등)
  - 재시도 옵션 (즉시/30분 후/1시간 후)
- **CTA**: "전체 재시도", "개별 재시도", "포기"
- **Next**: 재시도 진행 또는 큐 대시보드

## Business Rules

### 포스팅 API 규칙
- **사용 API**: Facebook Graph API → Instagram 포스팅
- **인증**: 각 페르소나별 Instagram Business Account 연결 필요
- **Rate Limit**: 계정당 시간당 최대 10개 포스팅 (Instagram 제한)

### 스케줄 실행 규칙
- **Cron Job**: 매 분마다 포스팅 큐 확인
- **실행 조건**: 현재 시간 >= 예약 시간
- **동시 실행**: 최대 10개 포스팅 동시 진행 (병렬 처리)

### 재시도 규칙
- **자동 재시도**:
  - API 일시적 오류: 5분 후 자동 재시도 (최대 3회)
  - Rate Limit 초과: 1시간 후 자동 재시도
- **수동 재시도**: 관리자가 수동으로 재시도 가능

### 포스팅 데이터 구조
- **이미지**: CDN URL 또는 로컬 파일 경로
- **캡션**: 텍스트 (최대 2,200자)
- **해시태그**: 캡션 끝에 자동 추가
- **위치 태그**: 옵션 (현재는 미사용)

## Edge Cases

### API 오류 처리
- **401 Unauthorized**: "계정 인증 만료, 재인증 필요" 알림
- **429 Rate Limit**: 자동으로 1시간 후 재시도
- **500 Server Error**: 5분 후 재시도 (최대 3회)

### 계정 정지
- Instagram이 계정 정지: "페르소나 'OO' 계정 정지됨" 알림
- 해당 페르소나 포스팅 일시 중단
- 관리자 수동 해결 필요

### 이미지 업로드 실패
- 이미지 파일 손상: "이미지 재생성 필요" 알림
- CDN 접근 불가: 로컬 파일로 재시도

### 동시성 문제
- 동일 포스팅 중복 실행 방지: DB 락 사용
- 큐 충돌 방지: 트랜잭션 처리

## Dependencies
- **001-persona**: 페르소나별 Instagram 계정 정보
- **005-approval**: 승인된 콘텐츠를 큐에 추가
- **연관 기능**:
  - 010-analytics: 포스팅 성공 후 성과 데이터 수집

## Technical Requirements (초기 추론)
- **API**: Facebook Graph API (Instagram Business API)
- **큐 시스템**: Bull (Redis 기반 작업 큐)
- **스케줄러**: Node-cron 또는 AWS EventBridge
- **파일 저장**: AWS S3 또는 Cloudinary (CDN)
- **DB 락**: PostgreSQL Advisory Lock 또는 Redis Lock

---

## 💡 더 구체화하려면

```
/appkit.spec 008-posting "포스팅 예약 취소 및 수정 기능"
/appkit.spec 008-posting "포스팅 성공률 모니터링 (일별 통계)"
/appkit.spec 008-posting "Instagram Story 자동 포스팅"
/appkit.spec 008-posting "페르소나별 포스팅 간격 자동 최적화"
```
