# Spec: 004-caption-generator

## Feature Name
캡션 자동 생성

## User Value (고객 가치)
- **자연스러운 톤앤매너**: 레퍼런스 계정 스타일을 학습하여 진짜 인플루언서처럼 작성
- **빠른 작성**: 이미지 맥락을 자동 분석하여 즉시 캡션 생성 (10분 → 10초)
- **해시태그 자동 추천**: 카테고리별 최적 해시태그 자동 추가
- **편집 자유도**: 자동 생성 후 수정 가능

## Target User (누가 쓸까?)
- **Primary**: 서비스 관리자 (콘텐츠 제작팀)
- **Use Case**:
  - 003-content-composer에서 생성한 이미지에 캡션 작성
  - 기존 이미지에 새 캡션 재작성
  - 배치 캡션 생성 (여러 이미지 일괄 처리)

## User Journey & Screen Flow

### 1. 캡션 생성 화면 (003에서 진입)
- **UI Elements**:
  - 좌측: 생성된 이미지 미리보기
  - 우측 상단: 페르소나 정보 (톤앤매너 표시)
  - 우측 중앙: 자동 생성 캡션 (편집 가능)
  - 우측 하단: 해시태그 목록 (클릭으로 추가/제거)
- **CTA**: "캡션 재생성", "005-approval로 진행"
- **Next**: 005-approval (승인 시스템)

### 2. 톤앤매너 설정 모달
- **UI Elements**:
  - 페르소나별 톤앤매너 프리셋 (002에서 분석된)
  - 커스텀 설정: 반말/존댓말, 이모지 빈도, 문장 길이
  - 샘플 캡션 미리보기
- **CTA**: "적용", "취소"
- **Next**: 캡션 생성 화면

### 3. 해시태그 관리 모달
- **UI Elements**:
  - 카테고리별 추천 해시태그 목록
  - 트렌딩 해시태그 (인스타그램 API)
  - 커스텀 해시태그 추가/삭제
- **CTA**: "선택 해시태그 적용", "취소"
- **Next**: 캡션 생성 화면

## Business Rules

### 캡션 생성 규칙
- **입력**:
  - 생성 이미지 (003-content-composer 결과)
  - 페르소나 정보 (톤앤매너)
  - 레퍼런스 캡션 샘플 (002-reference-crawl 분석 결과)
- **처리**:
  - 이미지 맥락 분석 (Vision API)
  - 톤앤매너 적용 (GPT-4)
  - 자연스러운 문장 생성
- **출력**:
  - 캡션 본문 (100-300자)
  - 해시태그 10-20개

### 톤앤매너 적용 규칙
- **페르소나별 스타일**:
  - Beauty: 친근함, 정보 전달, 이모지 많음
  - Fashion: 세련됨, 짧은 문장, 트렌디 키워드
  - Food: 맛 표현 풍부, 감탄사 자주 사용
  - Fitness: 동기부여 톤, 격려, 파워워드
- **레퍼런스 학습**:
  - 문장 길이 평균 유지
  - 이모지 사용 빈도 맞춤
  - 주요 키워드 반영

### 해시태그 추천 규칙
- **필수 해시태그** (카테고리별):
  - Beauty: #뷰티, #데일리메이크업, #스킨케어루틴
  - Fashion: #데일리룩, #OOTD, #패션스타그램
  - Food: #맛집, #먹스타그램, #foodie
- **트렌딩 해시태그**: 인스타그램 API에서 실시간 수집
- **개수 제한**: 최소 10개, 최대 30개

## Edge Cases

### 생성 실패 처리
- Vision API 오류: 기본 템플릿 캡션 사용
- GPT 생성 실패: 레퍼런스 캡션 중 유사한 것 제안
- 부적절한 표현 생성: 자동 필터링 후 재생성

### 이미지 맥락 분석 실패
- 이미지가 너무 추상적: "이미지를 확인하고 수동으로 캡션을 작성하세요" 안내
- 분석 타임아웃: 기본 캡션 생성 후 수동 편집 유도

## Dependencies
- **001-persona**: 페르소나 톤앤매너 정보
- **002-reference-crawl**: 레퍼런스 캡션 샘플, 톤앤매너 분석 결과
- **003-content-composer**: 생성 이미지
- **연관 기능**:
  - 005-approval: 캡션 + 이미지 승인 프로세스

## Technical Requirements (초기 추론)
- **이미지 분석**: OpenAI Vision API
- **캡션 생성**: GPT-4 with 톤앤매너 프롬프트
- **해시태그 수집**: Instagram Hashtag Search API
- **텍스트 필터링**: OpenAI Moderation API

---

## 💡 더 구체화하려면

```
/appkit.spec 004-caption-generator "캡션 A/B 테스트 (2-3개 버전 생성)"
/appkit.spec 004-caption-generator "캡션 길이 커스터마이징 (짧게/보통/길게)"
/appkit.spec 004-caption-generator "계절/이벤트 키워드 자동 반영 (크리스마스, 신년)"
```
