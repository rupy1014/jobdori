# Spec: 003-content-composer

## Feature Name
콘텐츠 조합기 (Content Composer) - 🔥 핵심 기능!

## User Value (고객 가치)
- **빠른 콘텐츠 제작**: 크롤링 결과에서 선택만 하면 즉시 이미지 생성 (15분 → 3분)
- **검증된 조합**: 이미 성공한 요소들을 조합하여 시행착오 최소화
- **무한 변주**: 동일 제품도 100가지 다른 스타일로 표현 가능
- **자동 프롬프트**: 나노바나나 프롬프트 자동 생성으로 전문 지식 불필요

## Target User (누가 쓸까?)
- **Primary**: 서비스 관리자 (콘텐츠 제작팀)
- **Use Case**:
  - 일반 콘텐츠 제작 (페르소나 일상 포스팅)
  - 광고 콘텐츠 제작 (브랜드 제품 노출)
  - 대량 배치 생성 (주간 콘텐츠 일괄 제작)

## User Journey & Screen Flow

### 1. 콘텐츠 제작 대시보드
- **UI Elements**:
  - 페르소나 선택 드롭다운
  - 제작 유형 선택 (일반/광고)
  - "새 콘텐츠 만들기" 버튼
  - 최근 생성 이미지 그리드 (상태: 생성 대기/완료/실패)
- **CTA**: "새 콘텐츠 만들기"
- **Next**: 조합 화면

### 2. 요소 조합 화면 (핵심!)
- **UI Elements**:
  - 좌측: 크롤링 갤러리 (002-reference-crawl 결과)
    - 탭: 장소 / 제품 / 포즈 / 분위기
    - 각 탭마다 이미지 그리드
    - 필터: 카테고리, 레퍼런스 계정
  - 우측 상단: 선택된 요소 미리보기
    - 선택 장소 썸네일 + 설명
    - 선택 제품 썸네일 + 설명
    - 선택 포즈 썸네일 + 설명
    - 선택 분위기 태그
  - 우측 하단: 나노바나나 프롬프트 (자동 생성)
    - 편집 가능한 텍스트 영역
    - 프롬프트 템플릿 드롭다운
- **CTA**: "이미지 생성", "프롬프트 재생성", "선택 초기화"
- **Next**: 이미지 생성 중 → 결과 미리보기

### 3. 이미지 생성 진행 화면
- **UI Elements**:
  - 진행 상태바
  - 생성 중 애니메이션
  - 예상 소요 시간 (30초 ~ 2분)
  - 취소 버튼
- **CTA**: "취소"
- **Next**: 생성 완료 → 결과 미리보기

### 4. 생성 결과 미리보기
- **UI Elements**:
  - 생성된 이미지 (큰 미리보기)
  - 사용된 프롬프트
  - 페르소나 정보 (프로필 이미지, 이름)
  - 만족도 평가 (👍/👎)
  - 편집 옵션 (재생성, 프롬프트 수정 후 재생성)
- **CTA**: "004-caption-generator로 진행", "재생성", "저장만 하기"
- **Next**: 004-caption-generator (캡션 작성) 또는 대시보드

### 5. 배치 생성 모드
- **UI Elements**:
  - 페르소나 다중 선택
  - 동일 조합으로 여러 페르소나 이미지 생성
  - 배치 큐 목록 (생성 대기/진행/완료)
- **CTA**: "배치 생성 시작"
- **Next**: 배치 진행 → 완료 후 대시보드

## Business Rules

### 요소 조합 규칙
- **필수 요소**: 장소, 포즈 (최소 2개 선택)
- **선택 요소**: 제품, 분위기 (옵션)
- **조합 제한**: 동일 조합은 이미지 variation 생성 가능

### 나노바나나 프롬프트 생성 규칙
- **기본 포맷**:
  ```
  [페르소나 특징] at [장소], [포즈/구도], [제품 설명], [분위기 키워드],
  professional Instagram photo, natural lighting, --ar 1:1 --style raw
  ```
- **페르소나 특징 삽입**: 001-persona의 프로필 정보 활용
- **자동 최적화**:
  - 카테고리별 스타일 키워드 추가 (Beauty → "natural makeup", Fashion → "trendy outfit")
  - 나노바나나 베스트 프랙티스 적용

### 이미지 생성 규칙
- **생성 API**: 나노바나나 API
- **이미지 비율**: 1:1 (Instagram 최적)
- **품질 설정**: High quality
- **재시도**: 생성 실패 시 최대 3회 자동 재시도
- **저장 위치**: `/assets/generated/[persona-id]/[timestamp]_[hash].jpg`

### 제품 합성 규칙 (광고 콘텐츠)
- 제품 이미지를 자연스럽게 배경에 합성
- 투명도, 크기 조정 옵션
- 브랜드 로고 추가 옵션 (미세 조정)

## Edge Cases

### 생성 실패 처리
- 나노바나나 API 오류: 3회 재시도 후 실패 알림
- 부적절한 이미지 생성: 자동 감지 후 재생성 제안
- 타임아웃: 2분 초과 시 재시도 옵션 제공

### 요소 선택 오류
- 필수 요소 미선택: "장소와 포즈를 선택해주세요" 경고
- 호환 불가 조합: "이 조합은 자연스럽지 않을 수 있습니다" 경고 (optional)

### 프롬프트 길이 제한
- 나노바나나 최대 토큰 제한 초과 시 자동 축약
- 중요 키워드 우선 유지

## Dependencies
- **001-persona**: 페르소나 프로필 정보 (이미지, 특징)
- **002-reference-crawl**: 크롤링 결과 (장소, 제품, 포즈, 분위기)
- **연관 기능**:
  - 004-caption-generator: 생성 이미지 전달하여 캡션 작성
  - 007-ad-content: 광고 콘텐츠 제작 시 제품 합성 기능 활용

## Technical Requirements (초기 추론)
- **이미지 생성 API**: 나노바나나 (Nanobanana)
- **프롬프트 최적화**: GPT-4를 활용한 자동 프롬프트 생성
- **이미지 합성**: Pillow/OpenCV (제품 합성용)
- **큐 시스템**: 배치 생성 시 큐 관리 (Redis/Bull)

---

## 💡 더 구체화하려면

```
/appkit.spec 003-content-composer "프롬프트 템플릿 관리 (카테고리별 저장/로드)"
/appkit.spec 003-content-composer "이미지 variation 생성 (동일 프롬프트, 다른 seed)"
/appkit.spec 003-content-composer "제품 자동 배치 (이미지 분석 기반 최적 위치)"
/appkit.spec 003-content-composer "조합 히스토리 및 즐겨찾기"
```
