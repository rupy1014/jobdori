# Spec: 009-engagement

## Feature Name
자동 소통 관리 (DM/댓글 자동 응답)

## User Value (고객 가치)
- **24/7 자동 응답**: 팔로워 DM/댓글에 즉시 자동 응답
- **자연스러운 대화**: 페르소나 톤앤매너 유지하며 응답
- **구매 전환**: 상품 문의 시 구매 링크 자동 전송
- **팔로워 관리**: 관심 표현 팔로워 자동 팔로우백

## Target User (누가 쓸까?)
- **Primary**: 서비스 관리자 (시스템이 자동 실행)
- **Use Case**:
  - 팔로워 DM 자동 응답
  - 포스트 댓글 자동 답글
  - 상품 문의 처리 (광고 콘텐츠)
  - 부적절한 메시지 필터링

## User Journey & Screen Flow

### 1. 소통 모니터링 대시보드
- **UI Elements**:
  - 실시간 DM/댓글 목록 (최신순)
  - 각 카드: 페르소나, 발신자명, 메시지 미리보기, 자동 응답 여부
  - 필터: 페르소나, 자동/수동, 날짜
  - 통계: 총 DM 수, 응답률, 평균 응답 시간
- **CTA**: 메시지 클릭 → 상세 보기
- **Next**: 메시지 상세 화면

### 2. 메시지 상세 & 수동 응답
- **UI Elements**:
  - 대화 히스토리 (채팅 형식)
  - 자동 응답 내역 (파란색 배지)
  - 수동 개입 필요 여부 (빨간색 배지)
  - 응답 입력 영역 (수동 응답용)
- **CTA**: "수동 응답 보내기", "자동 응답 재시작"
- **Next**: 대시보드

### 3. 자동 응답 설정
- **UI Elements**:
  - 페르소나별 응답 규칙 설정
  - 시나리오별 응답 템플릿:
    - 인사: "안녕하세요! 😊"
    - 상품 문의: "궁금하신 제품은 여기서 확인하세요 [링크]"
    - 칭찬: "감사합니다! ❤️"
    - 부정적: "죄송합니다. 피드백 감사드려요"
  - 자동 응답 활성화/비활성화 토글
- **CTA**: "저장"
- **Next**: 대시보드

### 4. 부적절한 메시지 필터
- **UI Elements**:
  - 필터링된 메시지 목록
  - 필터링 사유 (욕설, 스팸, 성희롱)
  - 차단 여부 결정
- **CTA**: "사용자 차단", "무시", "수동 응답"
- **Next**: 대시보드

## Business Rules

### DM 자동 응답 규칙
- **응답 트리거**:
  - 새 DM 수신 시 즉시 분석
  - 5분 내 자동 응답 (Instagram API 허용 범위)
- **응답 생성 로직**:
  - GPT-4로 메시지 의도 분석 (인사/문의/칭찬/부정적)
  - 페르소나 톤앤매너 적용 (002-reference-crawl 분석 결과)
  - 템플릿 기반 응답 생성
- **제한**:
  - Rate Limit: 계정당 시간당 최대 50개 DM 응답
  - 동일 사용자에게 연속 3회 응답 시 수동 개입 요청

### 댓글 자동 답글 규칙
- **응답 대상**:
  - 포스트 댓글 중 질문 형식 (물음표 포함)
  - 상품 문의 키워드 포함 ("어디서", "가격", "링크")
- **응답 제외**:
  - 스팸 댓글 (동일 내용 반복)
  - 부적절한 댓글 (욕설, 성희롱)

### 상품 문의 처리
- **키워드 감지**:
  - "어디서 사요?", "링크 주세요", "가격이 얼마예요?"
- **자동 응답**:
  - 광고 콘텐츠 (007-ad-content): 제품 구매 링크 자동 전송
  - 일반 콘텐츠: "DM으로 문의 주세요!" 안내

### 팔로워 자동 관리
- **자동 팔로우백**:
  - 댓글/DM 남긴 사용자 자동 팔로우
  - 단, 팔로워/팔로잉 비율 유지 (1.2 이하)
- **언팔로우 자동 처리**:
  - 3일간 상호작용 없으면 자동 언팔로우 (옵션)

## Edge Cases

### API 오류 처리
- Instagram API 다운: 자동 응답 일시 중단, 복구 시 재개
- Rate Limit 초과: 1시간 후 재개

### 부적절한 메시지
- 욕설/성희롱: 자동 차단 후 관리자 알림
- 스팸: 무시 (응답 안 함)

### 자동 응답 실패
- GPT 생성 실패: 기본 템플릿 응답 ("죄송합니다, 나중에 다시 연락드릴게요!")
- 의도 파악 불가: 수동 개입 요청

### 상품 링크 만료
- 광고 캠페인 종료 시 링크 비활성화
- "현재 품절입니다" 자동 응답

## Dependencies
- **001-persona**: 페르소나 톤앤매너 정보
- **002-reference-crawl**: 캡션 톤앤매너 분석 결과
- **007-ad-content**: 광고 콘텐츠의 제품 구매 링크
- **008-posting**: 포스팅된 콘텐츠 정보

## Technical Requirements (초기 추론)
- **API**: Instagram Graph API (DM, Comment)
- **의도 분석**: GPT-4 (메시지 의도 파악)
- **응답 생성**: GPT-4 with 톤앤매너 프롬프트
- **욕설 필터링**: OpenAI Moderation API
- **큐 시스템**: Bull (메시지 처리 큐)
- **Webhook**: Instagram Webhook (실시간 메시지 수신)

---

## 💡 더 구체화하려면

```
/appkit.spec 009-engagement "자동 응답 학습 (성공적인 응답 패턴 학습)"
/appkit.spec 009-engagement "FAQ 자동 생성 (자주 묻는 질문 자동 정리)"
/appkit.spec 009-engagement "감정 분석 기반 응답 조정 (화난 고객 우선 처리)"
```
